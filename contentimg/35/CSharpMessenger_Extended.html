<!DOCTYPE html><html lang="en" dir="ltr" class="client-nojs"><head><title>CSharpMessenger Extended - Unify Community Wiki</title><meta charset="UTF-8"><meta name="generator" content="MediaWiki 1.19.1"><link rel="shortcut icon" href="/favicon.ico"><link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Unify Community Wiki (en)"><link rel="EditURI" type="application/rsd+xml" href="http://wiki.unity3d.com/api.php?action=rsd"><link rel="copyright" href="http://creativecommons.org/licenses/by-sa/3.0/"><link rel="alternate" type="application/atom+xml" title="Unify Community Wiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom"><link rel="stylesheet" href="http://wiki.unity3d.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.vector&amp;only=styles&amp;skin=vector&amp;*"><meta name="ResourceLoaderDynamicStyles" content=""><link rel="stylesheet" href="http://wiki.unity3d.com/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=vector&amp;*"><style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}#quickbar a.new,a.new{color:#ba0000}</style><script src="http://wiki.unity3d.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script><script>window.mw&&mw.config.set({wgCanonicalNamespace:"",wgCanonicalSpecialPageName:!1,wgNamespaceNumber:0,wgPageName:"CSharpMessenger_Extended",wgTitle:"CSharpMessenger Extended",wgCurRevisionId:20079,wgArticleId:2553,wgIsArticle:!0,wgAction:"view",wgUserName:null,wgUserGroups:["*"],wgCategories:["Concepts","Design Patterns","Messaging","C Sharp"],wgBreakFrames:!1,wgPageContentLanguage:"en",wgSeparatorTransformTable:["",""],wgDigitTransformTable:["",""],wgRelevantPageName:"CSharpMessenger_Extended",wgRestrictionEdit:[],wgRestrictionMove:[]})</script><script>window.mw&&(mw.loader.implement("user.options",function(e){mw.user.options.set({ccmeonemails:0,cols:80,date:"default",diffonly:0,disablemail:0,disablesuggest:0,editfont:"default",editondblclick:0,editsection:1,editsectiononrightclick:0,enotifminoredits:0,enotifrevealaddr:0,enotifusertalkpages:1,enotifwatchlistpages:0,extendwatchlist:0,externaldiff:0,externaleditor:0,fancysig:0,forceeditsummary:0,gender:"unknown",hideminor:0,hidepatrolled:0,highlightbroken:1,imagesize:2,justify:0,math:1,minordefault:0,newpageshidepatrolled:0,nocache:0,noconvertlink:0,norollbackdiff:0,numberheadings:0,previewonfirst:0,previewontop:1,quickbar:5,rcdays:7,rclimit:50,rememberpassword:0,rows:25,searchlimit:20,showhiddencats:0,showjumplinks:1,shownumberswatching:1,showtoc:1,showtoolbar:1,skin:"vector",stubthreshold:0,thumbsize:2,underline:2,uselivepreview:0,usenewrc:0,watchcreations:0,watchdefault:0,watchdeletion:0,watchlistdays:3,watchlisthideanons:0,watchlisthidebots:0,watchlisthideliu:0,watchlisthideminor:0,watchlisthideown:0,watchlisthidepatrolled:0,watchmoves:0,wllimit:250,variant:"en",language:"en",searchNs0:!0,searchNs1:!1,searchNs2:!1,searchNs3:!1,searchNs4:!1,searchNs5:!1,searchNs6:!1,searchNs7:!1,searchNs8:!1,searchNs9:!1,searchNs10:!1,searchNs11:!1,searchNs12:!1,searchNs13:!1,searchNs14:!1,searchNs15:!1})},{},{}),mw.loader.implement("user.tokens",function(e){mw.user.tokens.set({editToken:"+\\",watchToken:!1})},{},{}))</script><script>window.mw&&mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"])</script><style type="text/css">.source-csharp{line-height:normal}.source-csharp li,.source-csharp pre{line-height:normal;border:0 none #fff}.csharp.source-csharp .de1,.csharp.source-csharp .de2{font:normal normal 1em/1.2em monospace;margin:0;padding:0;background:0 0;vertical-align:top}.csharp.source-csharp{font-family:monospace}.csharp.source-csharp .imp{font-weight:700;color:red}.csharp.source-csharp .li1,.csharp.source-csharp li{font-weight:400;vertical-align:top}.csharp.source-csharp .ln{width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top}.csharp.source-csharp .li2{font-weight:700;vertical-align:top}.csharp.source-csharp .kw1{color:#0600ff;font-weight:700}.csharp.source-csharp .kw2{color:#ff8000;font-weight:700}.csharp.source-csharp .kw3{color:green}.csharp.source-csharp .kw4{color:#66c;font-weight:700}.csharp.source-csharp .kw5{color:#000}.csharp.source-csharp .co1{color:teal;font-style:italic}.csharp.source-csharp .co2{color:teal}.csharp.source-csharp .co3{color:teal}.csharp.source-csharp .coMULTI{color:teal;font-style:italic}.csharp.source-csharp .es0{color:teal;font-weight:700}.csharp.source-csharp .es_h{color:teal;font-weight:700}.csharp.source-csharp .br0{color:green}.csharp.source-csharp .sy0{color:green}.csharp.source-csharp .st0{color:#666}.csharp.source-csharp .st_h{color:#666}.csharp.source-csharp .nu0{color:red}.csharp.source-csharp .me1{color:#00f}.csharp.source-csharp .me2{color:#00f}.csharp.source-csharp .ln-xtra,.csharp.source-csharp div.ln-xtra,.csharp.source-csharp li.ln-xtra{background-color:#ffc}.csharp.source-csharp span.xtra{display:block}</style><!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head><body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-CSharpMessenger_Extended skin-vector action-view"><div id="mw-page-base" class="noprint"></div><div id="mw-head-base" class="noprint"></div><div id="content" class="mw-body"><a id="top"></a><div id="mw-js-message" style="display:none"></div><h1 id="firstHeading" class="firstHeading"> <span dir="auto">CSharpMessenger Extended</span></h1><div id="bodyContent"><div id="siteSub">From Unify Community Wiki</div><div id="contentSub"></div><div id="jump-to-nav" class="mw-jump"> Jump to: <a href="#mw-head">navigation</a>, <a href="#p-search">search</a></div><div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>Author: Magnus Wolffelt (with Rod Hyde quotations), Julie Iaccarino (Callback return extensions, cleanup, covariance, slowdown, then speedup)</p><table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div><ul><li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li><li class="toclevel-1 tocsection-2"><a href="#Usage"><span class="tocnumber">2</span> <span class="toctext">Usage</span></a><ul><li class="toclevel-2 tocsection-3"><a href="#Writing_an_event_listener"><span class="tocnumber">2.1</span> <span class="toctext">Writing an event listener</span></a></li><li class="toclevel-2 tocsection-4"><a href="#Registering_an_event_listener"><span class="tocnumber">2.2</span> <span class="toctext">Registering an event listener</span></a></li><li class="toclevel-2 tocsection-5"><a href="#Unregistering_an_event_listener"><span class="tocnumber">2.3</span> <span class="toctext">Unregistering an event listener</span></a></li><li class="toclevel-2 tocsection-6"><a href="#Registering_a_callback_return"><span class="tocnumber">2.4</span> <span class="toctext">Registering a callback return</span></a><ul><li class="toclevel-3 tocsection-7"><a href="#Warning"><span class="tocnumber">2.4.1</span> <span class="toctext">Warning</span></a></li></ul></li><li class="toclevel-2 tocsection-8"><a href="#Broadcasting_an_event"><span class="tocnumber">2.5</span> <span class="toctext">Broadcasting an event</span></a></li><li class="toclevel-2 tocsection-9"><a href="#Messenger_Mode"><span class="tocnumber">2.6</span> <span class="toctext">Messenger Mode</span></a></li></ul></li><li class="toclevel-1 tocsection-10"><a href="#Code"><span class="tocnumber">3</span> <span class="toctext">Code</span></a><ul><li class="toclevel-2 tocsection-11"><a href="#Messenger.cs"><span class="tocnumber">3.1</span> <span class="toctext">Messenger.cs</span></a></li><li class="toclevel-2 tocsection-12"><a href="#MessengerUnitTest.cs"><span class="tocnumber">3.2</span> <span class="toctext">MessengerUnitTest.cs</span></a></li></ul></li></ul></td></tr></table><h2> <span class="mw-headline" id="Description">Description</span></h2><p>This tries to be a programmer-mistake-resilient delegate-based event system for C#. It uses generics to achieve static typing. Based on and inspired by Rod Hyde's <a href="/index.php/CSharpMessenger" title="CSharpMessenger">CSharpMessenger</a>, please refer to it for more usage details. The use of generics means that parameters can be of any type and are not restricted to subclasses of a special Message class - if a callback only needs a float then supply it with a float.</p><h2> <span class="mw-headline" id="Usage">Usage</span></h2><p>The main difference in usage from Hyde's implementation, is that with this messenger you can not have several events with same name, but different parameter signature. So for example, if you register a listener for "myEvent" with no parameters, and later try to register an event listener for "myEvent" that takes a float parameter, an exception will be thrown. Furthermore, there's an optional MessengerMode that allows for requiring at least one listener to exist when broadcasting an event. Generally, this Messenger will throw a lot of exceptions as soon as the programmer makes mistakes. Not all potential errors can be covered, but it tries to be strict in order to prevent silent, undetected bugs.</p><h3> <span class="mw-headline" id="Writing_an_event_listener">Writing an event listener</span></h3><div dir="ltr" class="mw-geshi mw-content-ltr"><div class="csharp source-csharp"><pre class="de1">    <span class="kw4">void</span> OnSpeedChanged<span class="br0">&#40;</span><span class="kw4">float</span> speed<span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">this</span><span class="sy0">.</span><span class="me1">speed</span> <span class="sy0">=</span> speed<span class="sy0">;</span>
    <span class="br0">&#125;</span></pre></div></div><h3> <span class="mw-headline" id="Registering_an_event_listener">Registering an event listener</span></h3><div dir="ltr" class="mw-geshi mw-content-ltr"><div class="csharp source-csharp"><pre class="de1">    <span class="kw4">void</span> OnEnable<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">AddListener</span><span class="br0">&#40;</span><span class="st0">&quot;speed changed&quot;</span>, OnSpeedChanged<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span></pre></div></div><h3> <span class="mw-headline" id="Unregistering_an_event_listener">Unregistering an event listener</span></h3><div dir="ltr" class="mw-geshi mw-content-ltr"><div class="csharp source-csharp"><pre class="de1">    <span class="kw4">void</span> OnDisable<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span><span class="st0">&quot;speed changed&quot;</span>, OnSpeedChanged<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span></pre></div></div><h3> <span class="mw-headline" id="Registering_a_callback_return">Registering a callback return</span></h3><p>In some cases, a return value will be desired when sending out a message. Callback returns act in this capacity, allowing a broadcaster to receive a return value for every subscriber listening to the event type.</p><p>The listener might look like this:</p><div dir="ltr" class="mw-geshi mw-content-ltr"><div class="csharp source-csharp"><pre class="de1">    <span class="kw4">void</span> OnDisable<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        Messenger<span class="sy0">.</span><span class="me1">AddListener</span><span class="sy0">&lt;</span><span class="kw4">int</span><span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="st0">&quot;getScore&quot;</span>, GetScore<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&#160;
    <span class="kw4">int</span> GetScore<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
    <span class="br0">&#125;</span></pre></div></div><p>Where the &lt;T&gt; parameter on the AddListener function declares a return type. It is still possible to use one, two, or three types for parameters on the main Messenger class.</p><p>The broadcast may look like this:</p><div dir="ltr" class="mw-geshi mw-content-ltr"><div class="csharp source-csharp"><pre class="de1">    <span class="kw4">void</span> OnDisable<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        Messenger<span class="sy0">.</span><span class="me1">Broadcast</span><span class="sy0">&lt;</span><span class="kw4">int</span><span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="st0">&quot;getScore&quot;</span>, OnGetScore<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&#160;
    <span class="kw4">void</span> OnGetScore<span class="br0">&#40;</span><span class="kw4">int</span> i<span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        Debug<span class="sy0">.</span><span class="me1">Log</span><span class="br0">&#40;</span><span class="kw4">string</span><span class="sy0">.</span><span class="me1">Format</span><span class="br0">&#40;</span><span class="st0">&quot;Score is {0}...&quot;</span>, i<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span></pre></div></div><p>It's important the signature matches the listener and the broadcaster.</p><h4> <span class="mw-headline" id="Warning">Warning</span></h4><p>RemoveListener should always be called on messages when loading a new level. Otherwise many MissingReferenceExceptions will be thrown, when invoking messages on destroyed objects. For example: 1. We registered a "speed changed" message in a Level1 scene. Afterwards the scene has been destroyed, but the "speed changed" message is still pointing to the OnSpeedChanged message handler in the destroyed class. 2. We loaded Level2 and registered another "speed changed" message, but the previous reference to the destroyed object hasn't been removed. We'll get a MissingReferenceException, because by invoking the "speed changed" message, the messaging system will first invoke the OnSpeedChanged handler of the destroyed object.</p><p><br></p><h3> <span class="mw-headline" id="Broadcasting_an_event">Broadcasting an event</span></h3><div dir="ltr" class="mw-geshi mw-content-ltr"><div class="csharp source-csharp"><pre class="de1">    <span class="kw1">if</span> <span class="br0">&#40;</span>speed <span class="sy0">!=</span> lastSpeed<span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">Broadcast</span><span class="br0">&#40;</span><span class="st0">&quot;speed changed&quot;</span>, speed<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span></pre></div></div><p><br></p><h3> <span class="mw-headline" id="Messenger_Mode">Messenger Mode</span></h3><p>Initially DEFAULT_MODE is set to require listeners, so you need to explicitly say a listener is not required when broadcasting. If preferred, change DEFAULT_MODE to not require listeners, so you must explicitly say when a listener is required:</p><div dir="ltr" class="mw-geshi mw-content-ltr"><div class="csharp source-csharp"><pre class="de1">MessengerInternal<span class="sy0">.</span><span class="me1">DEFAULT_MODE</span> <span class="sy0">=</span> MessengerMode<span class="sy0">.</span><span class="me1">DONT_REQUIRE_LISTENER</span><span class="sy0">;</span></pre></div></div><h2> <span class="mw-headline" id="Code">Code</span></h2><p>There are two files, <i>Messenger.cs</i> and <i>MessengerUnitTest.cs</i>. The last one is not required for usage.</p><h4> <span class="mw-headline" id="Messenger.cs">Messenger.cs</span></h4><div dir="ltr" class="mw-geshi mw-content-ltr"><div class="csharp source-csharp"><pre class="de1"><span class="co1">// Messenger.cs v1.0 by Magnus Wolffelt, magnus.wolffelt@gmail.com</span>
<span class="co1">// Version 1.4 by Julie Iaccarino, biscuitWizard @ github.com</span>
<span class="co1">//</span>
<span class="co1">// Inspired by and based on Rod Hyde's Messenger:</span>
<span class="co1">// http://www.unifycommunity.com/wiki/index.php?title=CSharpMessenger</span>
<span class="co1">//</span>
<span class="co1">// This is a C# messenger (notification center). It uses delegates</span>
<span class="co1">// and generics to provide type-checked messaging between event producers and</span>
<span class="co1">// event consumers, without the need for producers or consumers to be aware of</span>
<span class="co1">// each other. The major improvement from Hyde's implementation is that</span>
<span class="co1">// there is more extensive error detection, preventing silent bugs.</span>
<span class="co1">//</span>
<span class="co1">// Usage example:</span>
<span class="co1">// Messenger&lt;float&gt;.AddListener(&quot;myEvent&quot;, MyEventHandler);</span>
<span class="co1">// ...</span>
<span class="co1">// Messenger&lt;float&gt;.Broadcast(&quot;myEvent&quot;, 1.0f);</span>
<span class="co1">//</span>
<span class="co1">// Callback example:</span>
<span class="co1">// Messenger&lt;float&gt;.AddListener&lt;string&gt;(&quot;myEvent&quot;, MyEventHandler);</span>
<span class="co1">// private string MyEventHandler(float f1) { return &quot;Test &quot; + f1; }</span>
<span class="co1">// ...</span>
<span class="co1">// Messenger&lt;float&gt;.Broadcast&lt;string&gt;(&quot;myEvent&quot;, 1.0f, MyEventCallback);</span>
<span class="co1">// private void MyEventCallback(string s1) { Debug.Log(s1&quot;); }</span>
<span class="co1">//</span>
<span class="co1">// If preferred, change DEFAULT_MODE to not require listeners.</span>
&#160;
<span class="kw1">using</span> <span class="co3">System</span><span class="sy0">;</span>
<span class="kw1">using</span> <span class="co3">System.Collections.Generic</span><span class="sy0">;</span>
<span class="kw1">using</span> <span class="co3">System.Linq</span><span class="sy0">;</span>
&#160;
<span class="kw1">public</span> <span class="kw4">enum</span> MessengerMode <span class="br0">&#123;</span>
	DONT_REQUIRE_LISTENER,
	REQUIRE_LISTENER,
<span class="br0">&#125;</span>
&#160;
<span class="kw1">static</span> <span class="kw1">internal</span> <span class="kw4">class</span> MessengerInternal <span class="br0">&#123;</span>
	<span class="kw1">readonly</span> <span class="kw1">public</span> <span class="kw1">static</span> Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>, <span class="kw4">Delegate</span><span class="sy0">&gt;</span> eventTable <span class="sy0">=</span> <span class="kw3">new</span> Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>, <span class="kw4">Delegate</span><span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="kw1">static</span> <span class="kw1">public</span> MessengerMode DEFAULT_MODE <span class="sy0">=</span> MessengerMode<span class="sy0">.</span><span class="me1">REQUIRE_LISTENER</span><span class="sy0">;</span>
&#160;
 	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> AddListener<span class="br0">&#40;</span><span class="kw4">string</span> eventType, <span class="kw4">Delegate</span> callback<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnListenerAdding</span><span class="br0">&#40;</span>eventType, callback<span class="br0">&#41;</span><span class="sy0">;</span>
		eventTable<span class="br0">&#91;</span>eventType<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw4">Delegate</span><span class="sy0">.</span><span class="me1">Combine</span><span class="br0">&#40;</span>eventTable<span class="br0">&#91;</span>eventType<span class="br0">&#93;</span>, callback<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> RemoveListener<span class="br0">&#40;</span><span class="kw4">string</span> eventType, <span class="kw4">Delegate</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnListenerRemoving</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>	
		eventTable<span class="br0">&#91;</span>eventType<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw4">Delegate</span><span class="sy0">.</span><span class="me1">Remove</span><span class="br0">&#40;</span>eventTable<span class="br0">&#91;</span>eventType<span class="br0">&#93;</span>, handler<span class="br0">&#41;</span><span class="sy0">;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnListenerRemoved</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> T<span class="br0">&#91;</span><span class="br0">&#93;</span> GetInvocationList<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw4">Delegate</span> d<span class="sy0">;</span>
		<span class="kw1">if</span><span class="br0">&#40;</span>eventTable<span class="sy0">.</span><span class="me1">TryGetValue</span><span class="br0">&#40;</span>eventType, <span class="kw1">out</span> d<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="kw1">try</span> <span class="br0">&#123;</span>
				<span class="kw1">return</span> d<span class="sy0">.</span><span class="me1">GetInvocationList</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">Cast</span><span class="sy0">&lt;</span>T<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">ToArray</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#123;</span>
				<span class="kw1">throw</span> MessengerInternal<span class="sy0">.</span><span class="me1">CreateBroadcastSignatureException</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="br0">&#125;</span>
		<span class="br0">&#125;</span>
		<span class="kw1">return</span> <span class="kw3">new</span> T<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> OnListenerAdding<span class="br0">&#40;</span><span class="kw4">string</span> eventType, <span class="kw4">Delegate</span> listenerBeingAdded<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span>eventTable<span class="sy0">.</span><span class="me1">ContainsKey</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			eventTable<span class="sy0">.</span><span class="me1">Add</span><span class="br0">&#40;</span>eventType, <span class="kw1">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
&#160;
		var d <span class="sy0">=</span> eventTable<span class="br0">&#91;</span>eventType<span class="br0">&#93;</span><span class="sy0">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>d <span class="sy0">!=</span> <span class="kw1">null</span> <span class="sy0">&amp;&amp;</span> d<span class="sy0">.</span><span class="me1">GetType</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">!=</span> listenerBeingAdded<span class="sy0">.</span><span class="me1">GetType</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> ListenerException<span class="br0">&#40;</span><span class="kw4">string</span><span class="sy0">.</span><span class="me1">Format</span><span class="br0">&#40;</span><span class="st0">&quot;Attempting to add listener with inconsistent signature for event type {0}. Current listeners have type {1} and listener being added has type {2}&quot;</span>, eventType, d<span class="sy0">.</span><span class="me1">GetType</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">Name</span>, listenerBeingAdded<span class="sy0">.</span><span class="me1">GetType</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">Name</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> OnListenerRemoving<span class="br0">&#40;</span><span class="kw4">string</span> eventType, <span class="kw4">Delegate</span> listenerBeingRemoved<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>eventTable<span class="sy0">.</span><span class="me1">ContainsKey</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			var d <span class="sy0">=</span> eventTable<span class="br0">&#91;</span>eventType<span class="br0">&#93;</span><span class="sy0">;</span>
&#160;
			<span class="kw1">if</span> <span class="br0">&#40;</span>d <span class="sy0">==</span> <span class="kw1">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
				<span class="kw1">throw</span> <span class="kw3">new</span> ListenerException<span class="br0">&#40;</span><span class="kw4">string</span><span class="sy0">.</span><span class="me1">Format</span><span class="br0">&#40;</span><span class="st0">&quot;Attempting to remove listener with for event type {0} but current listener is null.&quot;</span>, eventType<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="br0">&#125;</span> <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>d<span class="sy0">.</span><span class="me1">GetType</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">!=</span> listenerBeingRemoved<span class="sy0">.</span><span class="me1">GetType</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
				<span class="kw1">throw</span> <span class="kw3">new</span> ListenerException<span class="br0">&#40;</span><span class="kw4">string</span><span class="sy0">.</span><span class="me1">Format</span><span class="br0">&#40;</span><span class="st0">&quot;Attempting to remove listener with inconsistent signature for event type {0}. Current listeners have type {1} and listener being removed has type {2}&quot;</span>, eventType, d<span class="sy0">.</span><span class="me1">GetType</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">Name</span>, listenerBeingRemoved<span class="sy0">.</span><span class="me1">GetType</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">Name</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="br0">&#125;</span>
		<span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> ListenerException<span class="br0">&#40;</span><span class="kw4">string</span><span class="sy0">.</span><span class="me1">Format</span><span class="br0">&#40;</span><span class="st0">&quot;Attempting to remove listener for type {0} but Messenger doesn't know about this event type.&quot;</span>, eventType<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> OnListenerRemoved<span class="br0">&#40;</span><span class="kw4">string</span> eventType<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>eventTable<span class="br0">&#91;</span>eventType<span class="br0">&#93;</span> <span class="sy0">==</span> <span class="kw1">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			eventTable<span class="sy0">.</span><span class="me1">Remove</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> OnBroadcasting<span class="br0">&#40;</span><span class="kw4">string</span> eventType, MessengerMode mode<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>mode <span class="sy0">==</span> MessengerMode<span class="sy0">.</span><span class="me1">REQUIRE_LISTENER</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>eventTable<span class="sy0">.</span><span class="me1">ContainsKey</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> MessengerInternal<span class="sy0">.</span><span class="me1">BroadcastException</span><span class="br0">&#40;</span><span class="kw4">string</span><span class="sy0">.</span><span class="me1">Format</span><span class="br0">&#40;</span><span class="st0">&quot;Broadcasting message {0} but no listener found.&quot;</span>, eventType<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> BroadcastException CreateBroadcastSignatureException<span class="br0">&#40;</span><span class="kw4">string</span> eventType<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw1">return</span> <span class="kw3">new</span> BroadcastException<span class="br0">&#40;</span><span class="kw4">string</span><span class="sy0">.</span><span class="me1">Format</span><span class="br0">&#40;</span><span class="st0">&quot;Broadcasting message {0} but listeners have a different signature than the broadcaster.&quot;</span>, eventType<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">public</span> <span class="kw4">class</span> BroadcastException <span class="sy0">:</span> Exception <span class="br0">&#123;</span>
		<span class="kw1">public</span> BroadcastException<span class="br0">&#40;</span><span class="kw4">string</span> msg<span class="br0">&#41;</span>
			<span class="sy0">:</span> <span class="kw1">base</span><span class="br0">&#40;</span>msg<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">public</span> <span class="kw4">class</span> ListenerException <span class="sy0">:</span> Exception <span class="br0">&#123;</span>
		<span class="kw1">public</span> ListenerException<span class="br0">&#40;</span><span class="kw4">string</span> msg<span class="br0">&#41;</span>
			<span class="sy0">:</span> <span class="kw1">base</span><span class="br0">&#40;</span>msg<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&#160;
<span class="co1">// No parameters</span>
<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">class</span> Messenger <span class="br0">&#123;</span> 
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> AddListener<span class="br0">&#40;</span><span class="kw4">string</span> eventType, Action handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> AddListener<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, Func<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> RemoveListener<span class="br0">&#40;</span><span class="kw4">string</span> eventType, Action handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> RemoveListener<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, Func<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="br0">&#40;</span><span class="kw4">string</span> eventType<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		Broadcast<span class="br0">&#40;</span>eventType, MessengerInternal<span class="sy0">.</span><span class="me1">DEFAULT_MODE</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, Action<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span> returnCall<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		Broadcast<span class="br0">&#40;</span>eventType, returnCall, MessengerInternal<span class="sy0">.</span><span class="me1">DEFAULT_MODE</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
 	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="br0">&#40;</span><span class="kw4">string</span> eventType, MessengerMode mode<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnBroadcasting</span><span class="br0">&#40;</span>eventType, mode<span class="br0">&#41;</span><span class="sy0">;</span>
		var invocationList <span class="sy0">=</span> MessengerInternal<span class="sy0">.</span><span class="me1">GetInvocationList</span><span class="sy0">&lt;</span>Action<span class="sy0">&gt;</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">foreach</span><span class="br0">&#40;</span>var callback <span class="kw1">in</span> invocationList<span class="br0">&#41;</span>
			callback<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, Action<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span> returnCall, MessengerMode mode<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnBroadcasting</span><span class="br0">&#40;</span>eventType, mode<span class="br0">&#41;</span><span class="sy0">;</span>
		var invocationList <span class="sy0">=</span> MessengerInternal<span class="sy0">.</span><span class="me1">GetInvocationList</span><span class="sy0">&lt;</span>Func<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;&gt;</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">foreach</span><span class="br0">&#40;</span>var result <span class="kw1">in</span> invocationList<span class="sy0">.</span><span class="kw1">Select</span><span class="br0">&#40;</span>del <span class="sy0">=&gt;</span> del<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">Cast</span><span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			returnCall<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span>result<span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&#160;
<span class="co1">// One parameter</span>
<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">class</span> Messenger<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> <span class="br0">&#123;</span>
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> AddListener<span class="br0">&#40;</span><span class="kw4">string</span> eventType, Action<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> AddListener<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, Func<span class="sy0">&lt;</span>T, TReturn<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> RemoveListener<span class="br0">&#40;</span><span class="kw4">string</span> eventType, Action<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> RemoveListener<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, Func<span class="sy0">&lt;</span>T, TReturn<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		Broadcast<span class="br0">&#40;</span>eventType, arg1, MessengerInternal<span class="sy0">.</span><span class="me1">DEFAULT_MODE</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, Action<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span> returnCall<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		Broadcast<span class="br0">&#40;</span>eventType, arg1, returnCall, MessengerInternal<span class="sy0">.</span><span class="me1">DEFAULT_MODE</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, MessengerMode mode<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnBroadcasting</span><span class="br0">&#40;</span>eventType, mode<span class="br0">&#41;</span><span class="sy0">;</span>
		var invocationList <span class="sy0">=</span> MessengerInternal<span class="sy0">.</span><span class="me1">GetInvocationList</span><span class="sy0">&lt;</span>Action<span class="sy0">&lt;</span>T<span class="sy0">&gt;&gt;</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">foreach</span><span class="br0">&#40;</span>var callback <span class="kw1">in</span> invocationList<span class="br0">&#41;</span>
			callback<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span>arg1<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, Action<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span> returnCall, MessengerMode mode<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnBroadcasting</span><span class="br0">&#40;</span>eventType, mode<span class="br0">&#41;</span><span class="sy0">;</span>
		var invocationList <span class="sy0">=</span> MessengerInternal<span class="sy0">.</span><span class="me1">GetInvocationList</span><span class="sy0">&lt;</span>Func<span class="sy0">&lt;</span>T, TReturn<span class="sy0">&gt;&gt;</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">foreach</span><span class="br0">&#40;</span>var result <span class="kw1">in</span> invocationList<span class="sy0">.</span><span class="kw1">Select</span><span class="br0">&#40;</span>del <span class="sy0">=&gt;</span> del<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span>arg1<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">Cast</span><span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			returnCall<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span>result<span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&#160;
&#160;
<span class="co1">// Two parameters</span>
<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">class</span> Messenger<span class="sy0">&lt;</span>T, U<span class="sy0">&gt;</span> <span class="br0">&#123;</span> 
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> AddListener<span class="br0">&#40;</span><span class="kw4">string</span> eventType, Action<span class="sy0">&lt;</span>T, U<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> AddListener<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, Func<span class="sy0">&lt;</span>T, U, TReturn<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> RemoveListener<span class="br0">&#40;</span><span class="kw4">string</span> eventType, Action<span class="sy0">&lt;</span>T, U<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> RemoveListener<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, Func<span class="sy0">&lt;</span>T, U, TReturn<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, U arg2<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		Broadcast<span class="br0">&#40;</span>eventType, arg1, arg2, MessengerInternal<span class="sy0">.</span><span class="me1">DEFAULT_MODE</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, U arg2, Action<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span> returnCall<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		Broadcast<span class="br0">&#40;</span>eventType, arg1, arg2, returnCall, MessengerInternal<span class="sy0">.</span><span class="me1">DEFAULT_MODE</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, U arg2, MessengerMode mode<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnBroadcasting</span><span class="br0">&#40;</span>eventType, mode<span class="br0">&#41;</span><span class="sy0">;</span>
		var invocationList <span class="sy0">=</span> MessengerInternal<span class="sy0">.</span><span class="me1">GetInvocationList</span><span class="sy0">&lt;</span>Action<span class="sy0">&lt;</span>T, U<span class="sy0">&gt;&gt;</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">foreach</span><span class="br0">&#40;</span>var callback <span class="kw1">in</span> invocationList<span class="br0">&#41;</span>
			callback<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span>arg1, arg2<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, U arg2, Action<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span> returnCall, MessengerMode mode<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnBroadcasting</span><span class="br0">&#40;</span>eventType, mode<span class="br0">&#41;</span><span class="sy0">;</span>
		var invocationList <span class="sy0">=</span> MessengerInternal<span class="sy0">.</span><span class="me1">GetInvocationList</span><span class="sy0">&lt;</span>Func<span class="sy0">&lt;</span>T, U, TReturn<span class="sy0">&gt;&gt;</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">foreach</span><span class="br0">&#40;</span>var result <span class="kw1">in</span> invocationList<span class="sy0">.</span><span class="kw1">Select</span><span class="br0">&#40;</span>del <span class="sy0">=&gt;</span> del<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span>arg1, arg2<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">Cast</span><span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			returnCall<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span>result<span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&#160;
&#160;
<span class="co1">// Three parameters</span>
<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">class</span> Messenger<span class="sy0">&lt;</span>T, U, V<span class="sy0">&gt;</span> <span class="br0">&#123;</span> 
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> AddListener<span class="br0">&#40;</span><span class="kw4">string</span> eventType, Action<span class="sy0">&lt;</span>T, U, V<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> AddListener<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, Func<span class="sy0">&lt;</span>T, U, V, TReturn<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> RemoveListener<span class="br0">&#40;</span><span class="kw4">string</span> eventType, Action<span class="sy0">&lt;</span>T, U, V<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> RemoveListener<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, Func<span class="sy0">&lt;</span>T, U, V, TReturn<span class="sy0">&gt;</span> handler<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType, handler<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, U arg2, V arg3<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		Broadcast<span class="br0">&#40;</span>eventType, arg1, arg2, arg3, MessengerInternal<span class="sy0">.</span><span class="me1">DEFAULT_MODE</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, U arg2, V arg3, Action<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span> returnCall<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		Broadcast<span class="br0">&#40;</span>eventType, arg1, arg2, arg3, returnCall, MessengerInternal<span class="sy0">.</span><span class="me1">DEFAULT_MODE</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, U arg2, V arg3, MessengerMode mode<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnBroadcasting</span><span class="br0">&#40;</span>eventType, mode<span class="br0">&#41;</span><span class="sy0">;</span>
		var invocationList <span class="sy0">=</span> MessengerInternal<span class="sy0">.</span><span class="me1">GetInvocationList</span><span class="sy0">&lt;</span>Action<span class="sy0">&lt;</span>T, U, V<span class="sy0">&gt;&gt;</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">foreach</span><span class="br0">&#40;</span>var callback <span class="kw1">in</span> invocationList<span class="br0">&#41;</span>
			callback<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span>arg1, arg2, arg3<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw1">static</span> <span class="kw1">public</span> <span class="kw4">void</span> Broadcast<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="kw4">string</span> eventType, T arg1, U arg2, V arg3, Action<span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span> returnCall, MessengerMode mode<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		MessengerInternal<span class="sy0">.</span><span class="me1">OnBroadcasting</span><span class="br0">&#40;</span>eventType, mode<span class="br0">&#41;</span><span class="sy0">;</span>
		var invocationList <span class="sy0">=</span> MessengerInternal<span class="sy0">.</span><span class="me1">GetInvocationList</span><span class="sy0">&lt;</span>Func<span class="sy0">&lt;</span>T, U, V, TReturn<span class="sy0">&gt;&gt;</span><span class="br0">&#40;</span>eventType<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">foreach</span><span class="br0">&#40;</span>var result <span class="kw1">in</span> invocationList<span class="sy0">.</span><span class="kw1">Select</span><span class="br0">&#40;</span>del <span class="sy0">=&gt;</span> del<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span>arg1, arg2, arg3<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">Cast</span><span class="sy0">&lt;</span>TReturn<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			returnCall<span class="sy0">.</span><span class="me1">Invoke</span><span class="br0">&#40;</span>result<span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></div></div><h4> <span class="mw-headline" id="MessengerUnitTest.cs">MessengerUnitTest.cs</span></h4><div dir="ltr" class="mw-geshi mw-content-ltr"><div class="csharp source-csharp"><pre class="de1"><span class="co1">// MessengerUnitTest.cs v1.0 by Magnus Wolffelt, magnus.wolffelt@gmail.com</span>
<span class="co1">// </span>
<span class="co1">// Some functionality testing of the classes in Messenger.cs.</span>
<span class="co1">// A lot of attention is paid to proper exception throwing from the Messenger.</span>
&#160;
<span class="kw1">using</span> <span class="co3">System</span><span class="sy0">;</span>
&#160;
<span class="kw4">class</span> MessengerUnitTest <span class="br0">&#123;</span>
&#160;
	<span class="kw1">private</span> <span class="kw1">readonly</span> <span class="kw4">string</span> eventType1 <span class="sy0">=</span> <span class="st0">&quot;__testEvent1&quot;</span><span class="sy0">;</span>
	<span class="kw1">private</span> <span class="kw1">readonly</span> <span class="kw4">string</span> eventType2 <span class="sy0">=</span> <span class="st0">&quot;__testEvent2&quot;</span><span class="sy0">;</span>
&#160;
	<span class="kw4">bool</span> wasCalled <span class="sy0">=</span> <span class="kw1">false</span><span class="sy0">;</span>
&#160;
	<span class="kw1">public</span> <span class="kw4">void</span> RunTest<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		RunAddTests<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		RunBroadcastTests<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		RunRemoveTests<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		Console<span class="sy0">.</span><span class="kw1">Out</span><span class="sy0">.</span><span class="me1">WriteLine</span><span class="br0">&#40;</span><span class="st0">&quot;All Messenger tests passed.&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
&#160;
	<span class="kw1">private</span> <span class="kw4">void</span> RunAddTests<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		Messenger<span class="sy0">.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType1, TestCallback<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">try</span> <span class="br0">&#123;</span>
			<span class="co1">// This should fail because we're adding a new event listener for same event type but a different delegate signature</span>
			Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType1, TestCallbackFloat<span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Unit test failure - expected a ListenerException&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span>MessengerInternal<span class="sy0">.</span><span class="me1">ListenerException</span> e<span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="co1">// All good</span>
		<span class="br0">&#125;</span>
&#160;
		Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">AddListener</span><span class="br0">&#40;</span>eventType2, TestCallbackFloat<span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
&#160;
	<span class="kw1">private</span> <span class="kw4">void</span> RunBroadcastTests<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		wasCalled <span class="sy0">=</span> <span class="kw1">false</span><span class="sy0">;</span>
		Messenger<span class="sy0">.</span><span class="me1">Broadcast</span><span class="br0">&#40;</span>eventType1<span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span>wasCalled<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Unit test failure - event handler appears to have not been called.&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="br0">&#125;</span>
		wasCalled <span class="sy0">=</span> <span class="kw1">false</span><span class="sy0">;</span>
		Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">Broadcast</span><span class="br0">&#40;</span>eventType2, 1<span class="sy0">.</span>0f<span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span>wasCalled<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Unit test failure - event handler appears to have not been called.&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="br0">&#125;</span>
&#160;
		<span class="co1">// No listener should exist for this event, but we don't require a listener so it should pass</span>
		Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">Broadcast</span><span class="br0">&#40;</span>eventType2 <span class="sy0">+</span> <span class="st0">&quot;_&quot;</span>, 1<span class="sy0">.</span>0f, MessengerMode<span class="sy0">.</span><span class="me1">DONT_REQUIRE_LISTENER</span><span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">try</span> <span class="br0">&#123;</span>
			<span class="co1">// Broadcasting for an event there exists listeners for, but using wrong signature</span>
			Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">Broadcast</span><span class="br0">&#40;</span>eventType1, 1<span class="sy0">.</span>0f, MessengerMode<span class="sy0">.</span><span class="me1">DONT_REQUIRE_LISTENER</span><span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Unit test failure - expected a BroadcastException&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
		<span class="kw1">catch</span> <span class="br0">&#40;</span>MessengerInternal<span class="sy0">.</span><span class="me1">BroadcastException</span> e<span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="co1">// All good</span>
		<span class="br0">&#125;</span>
&#160;
		<span class="kw1">try</span> <span class="br0">&#123;</span>
			<span class="co1">// Same thing, but now we (implicitly) require at least one listener</span>
			Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">Broadcast</span><span class="br0">&#40;</span>eventType2 <span class="sy0">+</span> <span class="st0">&quot;_&quot;</span>, 1<span class="sy0">.</span>0f<span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Unit test failure - expected a BroadcastException&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span>MessengerInternal<span class="sy0">.</span><span class="me1">BroadcastException</span> e<span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="co1">// All good</span>
		<span class="br0">&#125;</span>
&#160;
		<span class="kw1">try</span> <span class="br0">&#123;</span>
			<span class="co1">// Wrong generic type for this broadcast, and we implicitly require a listener</span>
			Messenger<span class="sy0">&lt;</span><span class="kw4">double</span><span class="sy0">&gt;.</span><span class="me1">Broadcast</span><span class="br0">&#40;</span>eventType2, <span class="nu0">1.0</span><span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Unit test failure - expected a BroadcastException&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span>MessengerInternal<span class="sy0">.</span><span class="me1">BroadcastException</span> e<span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="co1">// All good</span>
		<span class="br0">&#125;</span>
&#160;
	<span class="br0">&#125;</span>
&#160;
&#160;
	<span class="kw1">private</span> <span class="kw4">void</span> RunRemoveTests<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&#160;
		<span class="kw1">try</span> <span class="br0">&#123;</span>
			<span class="co1">// Removal with wrong signature should fail</span>
			Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType1, TestCallbackFloat<span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Unit test failure - expected a ListenerException&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
		<span class="kw1">catch</span> <span class="br0">&#40;</span>MessengerInternal<span class="sy0">.</span><span class="me1">ListenerException</span> e<span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="co1">// All good</span>
		<span class="br0">&#125;</span>
&#160;
		Messenger<span class="sy0">.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType1, TestCallback<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">try</span> <span class="br0">&#123;</span>
			<span class="co1">// Repeated removal should fail</span>
			Messenger<span class="sy0">.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType1, TestCallback<span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Unit test failure - expected a ListenerException&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
		<span class="kw1">catch</span> <span class="br0">&#40;</span>MessengerInternal<span class="sy0">.</span><span class="me1">ListenerException</span> e<span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="co1">// All good</span>
		<span class="br0">&#125;</span>
&#160;
&#160;
&#160;
		Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType2, TestCallbackFloat<span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">try</span> <span class="br0">&#123;</span>
			<span class="co1">// Repeated removal should fail</span>
			Messenger<span class="sy0">&lt;</span><span class="kw4">float</span><span class="sy0">&gt;.</span><span class="me1">RemoveListener</span><span class="br0">&#40;</span>eventType2, TestCallbackFloat<span class="br0">&#41;</span><span class="sy0">;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Unit test failure - expected a ListenerException&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
		<span class="kw1">catch</span> <span class="br0">&#40;</span>MessengerInternal<span class="sy0">.</span><span class="me1">ListenerException</span> e<span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="co1">// All good</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
&#160;
&#160;
	<span class="kw4">void</span> TestCallback<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		wasCalled <span class="sy0">=</span> <span class="kw1">true</span><span class="sy0">;</span>
		Console<span class="sy0">.</span><span class="kw1">Out</span><span class="sy0">.</span><span class="me1">WriteLine</span><span class="br0">&#40;</span><span class="st0">&quot;TestCallback() was called.&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&#160;
	<span class="kw4">void</span> TestCallbackFloat<span class="br0">&#40;</span><span class="kw4">float</span> f<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		wasCalled <span class="sy0">=</span> <span class="kw1">true</span><span class="sy0">;</span>
		Console<span class="sy0">.</span><span class="kw1">Out</span><span class="sy0">.</span><span class="me1">WriteLine</span><span class="br0">&#40;</span><span class="st0">&quot;TestCallbackFloat(float) was called.&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&#160;
		<span class="kw1">if</span> <span class="br0">&#40;</span>f <span class="sy0">!=</span> 1<span class="sy0">.</span>0f<span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Unit test failure - wrong value on float argument&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
&#160;
&#160;
&#160;
<span class="br0">&#125;</span></pre></div></div></div><div class="printfooter"> Retrieved from "<a href="http://wiki.unity3d.com/index.php?title=CSharpMessenger_Extended&amp;oldid=20079">http://wiki.unity3d.com/index.php?title=CSharpMessenger_Extended&amp;oldid=20079</a>"</div><div id="catlinks" class="catlinks"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/index.php/Special:Categories" title="Special:Categories">Categories</a>:<ul><li><a href="/index.php?title=Category:Concepts&amp;action=edit&amp;redlink=1" class="new" title="Category:Concepts (page does not exist)">Concepts</a></li><li><a href="/index.php/Category:Design_Patterns" title="Category:Design Patterns">Design Patterns</a></li><li><a href="/index.php?title=Category:Messaging&amp;action=edit&amp;redlink=1" class="new" title="Category:Messaging (page does not exist)">Messaging</a></li><li><a href="/index.php/Category:C_Sharp" title="Category:C Sharp">C Sharp</a></li></ul></div></div><div class="visualClear"></div></div></div><div id="mw-head" class="noprint"><div id="p-personal" class=""><h5>Personal tools</h5><ul><li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=CSharpMessenger+Extended" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in / create account</a></li></ul></div><div id="left-navigation"><div id="p-namespaces" class="vectorTabs"><h5>Namespaces</h5><ul><li id="ca-nstab-main" class="selected"><span><a href="/index.php/CSharpMessenger_Extended" title="View the content page [c]" accesskey="c">Page</a></span></li><li id="ca-talk"><span><a href="/index.php/Talk:CSharpMessenger_Extended" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li></ul></div><div id="p-variants" class="vectorMenu emptyPortlet"><h4></h4><h5><span>Variants</span><a href="#"></a></h5><div class="menu"><ul></ul></div></div></div><div id="right-navigation"><div id="p-views" class="vectorTabs"><h5>Views</h5><ul><li id="ca-view" class="selected"><span><a href="/index.php/CSharpMessenger_Extended">Read</a></span></li><li id="ca-viewsource"><span><a href="/index.php?title=CSharpMessenger_Extended&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li><li id="ca-history" class="collapsible"><span><a href="/index.php?title=CSharpMessenger_Extended&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li></ul></div><div id="p-cactions" class="vectorMenu emptyPortlet"><h5><span>Actions</span><a href="#"></a></h5><div class="menu"><ul></ul></div></div><div id="p-search"><h5><label for="searchInput">Search</label></h5><form action="/index.php" id="searchform"><div> <input type="search" name="search" title="Search Unify Community Wiki [f]" accesskey="f" id="searchInput"> <input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton"> <input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton"> <input type="hidden" name="title" value="Special:Search"></div></form></div></div></div><div id="mw-panel" class="noprint"><div id="p-logo"><a style="background-image:url(/images/wiki.png)" href="/index.php/Main_Page" title="Visit the main page"></a></div><div class="portal" id="p-Navigation"><h5>Navigation</h5><div class="body"><ul><li id="n-mainpage"><a href="/index.php/Main_Page" title="Visit the main page [z]" accesskey="z">Main Page</a></li><li id="n-Extensions"><a href="/index.php/Extensions">Extensions</a></li><li id="n-Particle-Library"><a href="/index.php/Particle_Library">Particle Library</a></li><li id="n-Programming"><a href="/index.php/Programming">Programming</a></li><li id="n-Scripts"><a href="/index.php/Scripts">Scripts</a></li><li id="n-Shaders"><a href="/index.php/Shaders">Shaders</a></li><li id="n-Wizards"><a href="/index.php/Wizards">Wizards</a></li></ul></div></div><div class="portal" id="p-Extras"><h5>Extras</h5><div class="body"><ul><li id="n-Tips.2C-Tricks.2C-Tools"><a href="/index.php/Tips">Tips, Tricks, Tools</a></li><li id="n-Tutorials"><a href="/index.php/Tutorials">Tutorials</a></li><li id="n-Unity-Projects"><a href="/index.php/Unity_Projects">Unity Projects</a></li><li id="n-Contests"><a href="/index.php/Contests">Contests</a></li><li id="n-IRC-Chatroom"><a href="/index.php/IRC">IRC Chatroom</a></li></ul></div></div><div class="portal" id="p-Quick_Links"><h5>Quick Links</h5><div class="body"><ul><li id="n-portal"><a href="/index.php/Unify:Community_portal" title="About the project, what you can do, where to find things">Community portal</a></li><li id="n-recentchanges"><a href="/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-New-Pages"><a href="/index.php/Special:NewPages">New Pages</a></li><li id="n-help"><a href="/index.php/Help:Contents" title="The place to find out">Help</a></li></ul></div></div><div class="portal" id="p-tb"><h5>Toolbox</h5><div class="body"><ul><li id="t-whatlinkshere"><a href="/index.php/Special:WhatLinksHere/CSharpMessenger_Extended" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="/index.php/Special:RecentChangesLinked/CSharpMessenger_Extended" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="/index.php/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li><a href="/index.php?title=CSharpMessenger_Extended&amp;printable=yes" rel="alternate">Printable version</a></li><li id="t-permalink"><a href="/index.php?title=CSharpMessenger_Extended&amp;oldid=20079" title="Permanent link to this revision of the page">Permanent link</a></li></ul></div></div></div><div id="footer"><ul id="footer-info"><li id="footer-info-lastmod"> This page was last modified on 6 September 2018, at 13:40.</li><li id="footer-info-viewcount">This page has been accessed 124,871 times.</li><li id="footer-info-copyright">Content is available under <a class="external" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution Share Alike</a>.</li></ul><ul id="footer-places"><li id="footer-places-privacy"><a href="/index.php/Unify:Privacy_policy" title="Unify:Privacy policy">Privacy policy</a></li><li id="footer-places-about"><a href="/index.php/Unify:About" title="Unify:About">About Unify Community Wiki</a></li><li id="footer-places-disclaimer"><a href="/index.php/Unify:General_disclaimer" title="Unify:General disclaimer">Disclaimers</a></li></ul><ul id="footer-icons" class="noprint"><li id="footer-copyrightico"> <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="/skins/common/images/cc-by-sa.png" alt="Creative Commons Attribution Share Alike" width="88" height="31"></a></li><li id="footer-poweredbyico"> <a href="//www.mediawiki.org/"><img src="/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31"></a></li></ul><div style="clear:both"></div></div><script src="http://wiki.unity3d.com/load.php?debug=false&amp;lang=en&amp;modules=skins.vector&amp;only=scripts&amp;skin=vector&amp;*"></script><script>window.mw&&mw.loader.load(["mediawiki.user","mediawiki.page.ready"],null,!0)</script><script src="http://wiki.unity3d.com/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=vector&amp;*"></script></body></html>